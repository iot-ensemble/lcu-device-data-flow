<div fxFlexFill class="manage">
  <!-- Emulated Devices -->
  <div class="emulated section">
    <mat-card>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>contactless</mat-icon>
        </div>

        <mat-card-title>Emulated Devices</mat-card-title>

        <div fxFlex></div>

        <lcu-enabled-toggle
          [enabled]="Emulated?.Enabled"
          [loading]="Emulated?.Loading"
          (enabled-toggled)="ToggleEmulatedEnabledChanged($event)"
        ></lcu-enabled-toggle>

        <a
          href="https://www.iot-ensemble.com/docs/getting-started/emulated-data"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </mat-card-header>

      <mat-card-content class="margin-left-5">
        <p>
          To see the dashboard in action without connecting a device, enable the
          emulated device data. When enabled, emulated data will be provided in
          your data queries. The emulated device we are showing here is for
          smart room detection and provides data on the temperature, humidity
          and occupancy of a room.
        </p>
      </mat-card-content>

      <mat-card-actions> </mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Emulated Devices ^^^-->

  <!-- Connected Devices -->
  <div
    fxLayout="row"
    fxLayout.lt-md="column"
    fxLayoutGap="1em"
    class="connected section"
  >
    <mat-card [fxFlex]="ConnectedDevicesInfoCardFlex" fxFlex.lt-md="100%">
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          [class.orange-accent]="!AddingDevice"
          [class.green-accent]="AddingDevice"
        >
          <mat-icon>loop</mat-icon>
        </div>
        <mat-card-title> Connected Devices </mat-card-title>
        <div fxFlex></div>
        <mat-card-subtitle *ngIf="MaxDevicesReached && AddingDevice">
          Max number of devices reached
        </mat-card-subtitle>
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/connecting-first-device"
          target="”_blank”"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </mat-card-header>

      <mat-card-content
        [class.margin-left-5]="AddingDevice || Devices?.Devices?.length <= 0"
      >
        <mat-progress-bar
          class="margin-top-2"
          mode="indeterminate"
          *ngIf="Devices?.Loading"
        ></mat-progress-bar>

        <div *ngIf="AddingDevice">
          <ng-container *ngIf="!MaxDevicesReached">
            <p class="paragraph-text">
              To connect a device and see its real-time data flowing through the
              system, simply enter a device name and enroll it. You will be
              provided with a connection string for your device.
            </p>
          </ng-container>

          <ng-container *ngIf="MaxDevicesReached">
            <p class="paragraph-text">
              Click "Upgrade Now" to see other plans where you can connect more
              than
              {{ Devices.MaxDevicesCount }}
              {{ Devices.MaxDevicesCount > 1 ? "devices" : "device" }}, increase
              your data velocity, increase your data retention and other great
              benefits.
            </p>
          </ng-container>
        </div>

        <div class="device-list" *ngIf="!AddingDevice">
          <lcu-devices-table
            [devices-config]="Devices"
            (issued-sas-token)="IssueDeviceSASToken($event)"
            (page-event)="DeviceTablePageEvent($event)"
            (revoked)="RevokeDeviceEnrollmentClick($event)"
          ></lcu-devices-table>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <div fxFlex></div>

        <a
          mat-raised-button
          color="accent"
          (click)="ToggleAddingDevice()"
          *ngIf="!AddingDevice"
        >
          Enroll New Device
        </a>

        <ng-container *ngIf="AddingDevice && MaxDevicesReached">
          <a
            mat-button
            href="https://www.iot-ensemble.com/docs/getting-started/buy-and-scale"
            target="_blank"
            *ngIf="AddingDevice"
          >
            Read Documentation
          </a>

          <a
            mat-raised-button
            href="/billing/iot"
            color="accent"
            target="_blank"
          >
            Upgrade now
          </a>

          <a mat-button color="warn" (click)="ToggleAddingDevice()">
            <mat-icon>cancel</mat-icon>
            Cancel
          </a>
        </ng-container>
      </mat-card-actions>
    </mat-card>

    <form
      fxFlex="50%"
      [formGroup]="AddDeviceFormGroup"
      (ngSubmit)="EnrollDeviceSubmit()"
      *ngIf="AddingDevice && !MaxDevicesReached"
    >
      <mat-card>
        <mat-card-content>
          <div>
            <div class="device-adding">
              <h2>Enroll a New Device</h2>

              <mat-form-field>
                <input
                  matInput
                  formControlName="deviceName"
                  placeholder="The Name of your Device"
                  required
                />
              </mat-form-field>
            </div>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <div fxFlex></div>

          <ng-container>
            <button
              mat-raised-button
              type="submit"
              color="primary"
              *ngIf="!Devices?.Loading"
              [disabled]="!AddDeviceFormGroup.valid"
            >
              Enroll Device
            </button>

            <a mat-button color="warn" (click)="ToggleAddingDevice()">
              <mat-icon>cancel</mat-icon>
              Cancel
            </a>
          </ng-container>
        </mat-card-actions>
      </mat-card>
    </form>
  </div>
  <!--^^^ Connected Devices ^^^-->

  <!-- Telemetry -->
  <div class="telemetry section">
    <mat-card>
      <mat-card-header class="border-bottom">
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>compare_arrows</mat-icon>
        </div>

        <mat-card-title>Devices Telemetry</mat-card-title>

        <mat-card-subtitle
          fxLayout="row"
          fxLayoutAlign="start center"
          class="telemetry-update"
        >
          <lcu-loader
            [loading]="Telemetry?.Loading"
            [diameter]="20"
          ></lcu-loader>

          <div
            matTooltip="Updates successful"
            *ngIf="!Telemetry?.Loading"
            [class.success-dot]="Telemetry?.Enabled"
            [class.error-dot]="!Telemetry?.Enabled"
          ></div>

          Last Updated: {{ LastSyncedAt }}
        </mat-card-subtitle>

        <div
          fxFlex
          fxLayout="row"
          fxLayoutGap="20px"
          fxLayoutAlign="end center"
        >
          <!-- <lcu-refresh-select
                    [telemetry]="Telemetry"
                    (refresh-rate-changed)="RefreshRateChanged($event)"
                  >
                  </lcu-refresh-select> -->

          <button
            mat-button
            color="primary"
            matTooltip="Download Telemetry Data"
            (click)="DownloadTelemetryModal()"
          >
            <mat-icon id="telemetry-download-element">download</mat-icon>
          </button>

          <lcu-enabled-toggle
            [enabled]="Telemetry?.Enabled"
            enabled-text="Live"
            [loading]="Telemetry?.Loading"
            (enabled-toggled)="ToggleTelemetryEnabledChanged($event)"
          >
          </lcu-enabled-toggle>
        </div>
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/viewing-device-data#devices-telemetry"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </mat-card-header>

      <mat-card-content
        [class.margin-left-5]="Telemetry?.Payloads?.length <= 0"
      >
        <lcu-telemetry-list
          [telemetry]="Telemetry"
          (page-event)="HandleTelemetryPageEvent($event)"
        >
        </lcu-telemetry-list>
      </mat-card-content>

      <mat-card-actions>
        <div fxFlex></div>

        <button
          mat-raised-button
          color="primary"
          (click)="PayloadFormModal()"
          *ngIf="Devices?.Devices?.length >= 1"
        >
          Send Device Message
        </button>

        <!-- <button mat-raised-button (click)="DownloadData()">
                  Download Data
                </button> -->
      </mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Telemetry ^^^-->

  <!-- Dashboard -->
  <div class="dashboard section">
    <mat-card>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>dashboard</mat-icon>
        </div>

        <mat-card-title>Devices Dashboard</mat-card-title>
        <div fxFlex></div>
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/viewing-device-data#freeboard-dashboard"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </mat-card-header>

      <mat-card-content>
        <div class="margin-left-5 padding-bottom-2 margin-top-2">
          Here we have provided an example open-source dashboard Freeboard to
          show how your data can be visualized. Freeboard provides simple and
          easy to use dashboards for your devices.
        </div>
        <div class="freeboard-display padding-top-2">
          <iframe
            [src]="DashboardIFrameURL"
            width="100%"
            height="750px"
            frameborder="0"
          ></iframe>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <!--^^^ Dashboard ^^^-->

  <!-- Device Reports -->
  <!-- <div class="device-reports widget">
            <mat-card>
              <mat-card-header>
                <mat-card-title>Device Reports</mat-card-title>
              </mat-card-header>
            </mat-card>
          </div> -->

  <!-- Storage Access -->
  <div class="storage-access section">
    <mat-card>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>storage</mat-icon>
        </div>

        <mat-card-title>Storage Access</mat-card-title>
        <div fxFlex></div>
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/connecting-downstream-services"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </mat-card-header>

      <mat-card-content>
        <div class="margin-left-5 margin-top-2">
          Use the API keys to get your data downstream to the dashboards and
          services of your choice for visualization, application development,
          ML/AI, and more.
        </div>
        <lcu-api-access
          [api-keys]="Storage?.APIKeys"
          [api-options]="Storage?.APIOptions"
          (regenerated)="RegenerateAPIKey($event)"
        ></lcu-api-access>
      </mat-card-content>

      <mat-card-actions></mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Storage Access ^^^-->
</div>
