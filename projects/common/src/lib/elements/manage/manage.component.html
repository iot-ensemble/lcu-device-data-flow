<div fxFlexFill *ngIf="!State?.Loading">
  <div fxFlexFill fxLayout="column" fxLayoutGap="5px">
    <div fxLayout="row" fxLayoutGap="5px">
      <div
        fxFlex="75"
        fxLayoutAlign="start end"
        class="welcome-bg background-fill"
      >
        <div class="welcome-index" fxLayout="row" fxLayoutGap="30px">
          <div fxFlex="30">
            <h1 fxLayout="column">
              <span class="plain-text theme-accent-text margin-bottom-2">
                Welcome to
              </span>
              <span class="mat-display-1 plain-text">IoT Ensemble</span>
            </h1>
          </div>
          <div class="divider-fill-vert"></div>
          <div fxLayout="column">
            <h2 class="plain-text theme-accent-text">Device Dashboard</h2>
            <p>
              Emulate, simulate, and connect your devices to unlock the power of
              your IoT applications.
            </p>
          </div>
        </div>
      </div>
      <div fxFlex class="background-fill blank-header"></div>
    </div>

    <!-- <div style="height: 200px; width: 100px; background-color: rgb(192, 24, 24);"
      [@onSideNavOpenClose]="SideNavSrvc.SideNavToggleVal ? 'open' : 'close'">test
      </div> -->

    <div fxFlexFill fxLayout="row">
      <div fxFlex fxLayout="row" fxLayoutGap="5px">
        <!-- left side -->
        <div
          [@onSideNavOpenClose]="
            SideNavSrvc.SideNavToggleVal ? 'open' : 'close'
          "
          (@onSideNavOpenClose.done)="OnSideNavOpenCloseDoneEvent($event)"
          fxFlex="25"
          fxLayout="row"
          fxFill
          fxLayoutAlign="start start"
          class="background-fill box-side-triangle"
        >
          <div fxLayout="column">
            <div
              [@onSideNavOpenClose]="
                SideNavSrvc.SideNavToggleVal ? 'open' : 'close'
              "
              fxLayoutAlign="end"
            >
              <button mat-icon-button (click)="ToggleSideNav()">
                <mat-icon *ngIf="SideNavSrvc.SideNavToggleVal"
                  >arrow_left</mat-icon
                >
                <mat-icon *ngIf="!SideNavSrvc.SideNavToggleVal"
                  >arrow_right</mat-icon
                >
              </button>
            </div>

            <div
              [ngStyle]="{
                display: SideNavOpenCloseEvent === true ? 'none' : 'block'
              }"
              fxLayout="column"
              fxFlex="90"
              class="padding-left-5 padding-right-5 padding-top-5"
            >
              <div class="divider-fill-hor"></div>

              <h3 class="mat-display-5 plain-text whats-next-text">
                Getting Started?
              </h3>

              <p>
                Check out our getting started
                <a
                  mat-link-button
                  href="https://www.iot-ensemble.com/docs/getting-started/setup"
                  target="_blank"
                >
                  documentation
                </a>
              </p>

              <div class="divider-fill-hor"></div>
            </div>
          </div>
        </div>
        <!--^^^ Left Side ^^^-->

        <!-- Content -->
        <div
          fxFlex
          fxLayout="column"
          fxLayoutGap="10px"
          class="background-fill padding-left-2 padding-right-2 padding-top-2"
        >
          <!-- Emulated Devices -->
          <div>
            <mat-card>
              <mat-card-header>
                <mat-card-title>Emulated Devices</mat-card-title>

                <div fxFlex></div>

                <lcu-enabled-toggle
                  [enabled]="State.Emulated?.Enabled"
                  (enabled-toggled)="ToggleEmulatedEnabledChanged($event)"
                ></lcu-enabled-toggle>
              </mat-card-header>

              <mat-card-content>
                <p>
                  When enabled, emulated device data will be provided in your
                  data queries. The emulated device, is for smart room detection
                  and provides temperature, humidity and occupancy of a room.
                </p>
              </mat-card-content>

              <mat-card-actions> </mat-card-actions>
            </mat-card>
          </div>
          <!--^^^ Emulated Devices ^^^-->

          <!-- Connected Devices -->
          <div
            fxLayout="row"
            fxLayout.lt-md="column"
            fxLayoutGap="10px"
            class="connected"
          >
            <mat-card fxFlex="50" *ngIf="AddingDevice">
              <mat-card-header>
                <div
                  mat-card-avatar
                  fxLayoutAlign="center center"
                  class="orange-accent"
                >
                  <mat-icon>loop</mat-icon>
                </div>
                <mat-card-title>Connect a new Device</mat-card-title>
              </mat-card-header>
              <mat-card-content class="margin-left-5">
                <span class="paragraph-text">
                  Say something about what we're doing here. Some sort of image
                  in the background.
                </span>
              </mat-card-content>
            </mat-card>
            <form
              fxFlex
              [formGroup]="AddDeviceFormGroup"
              (ngSubmit)="EnrollDeviceSubmit()"
            >
              <mat-card>
                <mat-card-content>
                  <div class="device-list" *ngIf="!AddingDevice">
                    <lcu-devices-table
                      [devices]="State.ConnectedDevicesConfig?.Devices"
                      [displayed-columns]="ConnectedDevicesDisplayedColumns"
                      (issued-sas-token)="IssueDeviceSASToken($event)"
                      (page-size-changed)="DeviceTablePageEvent($event)"
                      (revoked)="RevokeDeviceEnrollmentClick($event)"
                    ></lcu-devices-table>
                  </div>

                  <div class="device-adding" *ngIf="AddingDevice">
                    <h2>Enroll a New Device</h2>

                    <mat-form-field>
                      <input
                        matInput
                        formControlName="deviceName"
                        placeholder="The Name of your Device"
                        required
                      />
                    </mat-form-field>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <div fxFlex></div>
                  <ng-container *ngIf="!AddingDevice">
                    <a mat-raised-button (click)="ToggleAddingDevice()">
                      Add New Device
                    </a>
                  </ng-container>

                  <ng-container *ngIf="AddingDevice">
                    <button
                      mat-raised-button
                      type="submit"
                      color="primary"
                      [disabled]="!AddDeviceFormGroup.valid"
                    >
                      Enroll Device
                    </button>

                    <a mat-button color="warn" (click)="ToggleAddingDevice()">
                      <mat-icon>cancel</mat-icon>
                      Cancel
                    </a>
                  </ng-container>
                </mat-card-actions>
              </mat-card>
            </form>
          </div>
          <!--^^^ Connected Devices ^^^-->

          <!-- Dashboard / Telemetry -->
          <div fxLayout="column" fxLayoutGap="10px">

            <!-- Telemetry -->
            <div fxFlex class="telemetry">
              <mat-card>
                <mat-card-header class="border-bottom">
                  <mat-card-title>Device Telemetry</mat-card-title>
                  <mat-card-subtitle
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    class="telemetry-update">
                    <mat-spinner
                      *ngIf="State.Telemetry?.Loading"
                      [diameter]="10">
                    </mat-spinner>
                    <div
                      matTooltip="Updates successful"
                      *ngIf="!State.Telemetry?.Loading"
                      class="success-dot">
                    </div>

                    Last Updated: {{ LastSyncedAt }}
                  </mat-card-subtitle>
                  <div
                    fxFlex
                    fxLayout="row"
                    fxLayoutGap="20px"
                    fxLayoutAlign="end center">
                    <button
                      mat-flat-button
                      color="accent"
                      (click)="PayloadFormModal()">
                      Payload Form
                    </button>
                    <lcu-refresh-select
                      [state]="State"
                      (refresh-rate-changed)="RefreshRateChanged($event)">
                    </lcu-refresh-select>
                    <lcu-enabled-toggle
                      [enabled]="State.Telemetry?.Enabled"
                      enabled-text="Live"
                      (enabled-toggled)="ToggleTelemetryEnabledChanged($event)">
                    </lcu-enabled-toggle>
                  </div>
                </mat-card-header>
                <mat-card-content>
                  <lcu-telemetry-list
                    [telemetry]="State.Telemetry"
                    (page-size-changed)="HandlePageSizeChange($event)"
                  ></lcu-telemetry-list>

                  <!-- <lcu-payload-form
                    [device-options]="DeviceNames"
                    (sent)="SendDeviceMesaage($event)"
                  ></lcu-payload-form> -->
                  <ng-template #ModalContainer></ng-template>
                </mat-card-content>

                <mat-card-actions> </mat-card-actions>
              </mat-card>
            </div>
            <!--^^^ Telemetry ^^^-->

            <!-- Dashboard -->
            <div fxFlex="50">
              <div class="dashboard">
                <mat-card>
                  <mat-card-header>
                    <mat-card-title>Devices Dashboard</mat-card-title>
                  </mat-card-header>

                  <mat-card-content>
                    <div class="freeboard-display">
                      <iframe
                        [src]="DashboardIFrameURL"
                        width="100%"
                        height="500px"
                        frameborder="0"
                      ></iframe>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>
            <!--^^^ Dashboard ^^^-->
          </div>
          <!--^^^ Dashboard / Telemetry ^^^-->

          <!-- Device Reports -->
          <!-- <div>
            <mat-card>
              <mat-card-header>
                <mat-card-title>Device Reports</mat-card-title>
              </mat-card-header>
            </mat-card>
          </div> -->

          <!-- Storage Access -->
          <div>
            <mat-card>
              <mat-card-header>
                <mat-card-title>Storage Access</mat-card-title>
              </mat-card-header>

              <mat-card-content> </mat-card-content>

              <mat-card-actions></mat-card-actions>
            </mat-card>
          </div>
        </div>
        <!--^^^ Storage Access ^^^-->
      </div>
      <!--^^^ Content ^^^-->
    </div>
  </div>
</div>


<lcu-loader [loading]="State?.Loading"></lcu-loader>
