<div fxFlexFill class="manage">
  <!-- Emulated Devices -->
  <div class="emulated section">
    <mat-card fxLayout="column">
      <div
        fxFlex
        fxLayout="row"
        fxLayoutAlign="end start"
        class="margin-bottom-3"
      >
        <lcu-enabled-toggle
          class="margin-right-3"
          [enabled]="Emulated?.Enabled"
          [loading]="Emulated?.Loading"
          (enabled-toggled)="ToggleEmulatedEnabledChanged($event)"
        >
        </lcu-enabled-toggle>

        <a
          href="https://www.iot-ensemble.com/docs/getting-started/emulated-data"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </div>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent margin-bottom-3"
        >
          <mat-icon>contactless</mat-icon>
        </div>

        <mat-card-title>Emulated Devices</mat-card-title>
      </mat-card-header>

      <mat-card-content class="margin-left-5">
        <p>
          To see the dashboard in action without connecting a device, enable the
          emulated device data. When enabled, emulated data will be provided in
          your data queries. The emulated device we are showing here is for
          smart room detection and provides data on the temperature, humidity
          and occupancy of a room.
        </p>
      </mat-card-content>

      <mat-card-actions> </mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Emulated Devices ^^^-->

  <!-- Connected Devices -->
  <div class="connected section">
    <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="1em">
      <!--
    fxLayout="column"> -->
      <mat-card
        fxLayout="column"
        [fxFlex]="ConnectedDevicesInfoCardFlex"
        fxFlex.lt-md="100%"
      >
        <div fxFlex fxLayout="row" fxLayoutAlign="end" class="margin-bottom-3">
          <a
            href="https://www.iot-ensemble.com/docs/getting-started/emulated-data"
            target="_blank"
          >
            <mat-icon matTooltip="More info">help_outline</mat-icon>
          </a>
        </div>

        <mat-card-header>
          <div
            mat-card-avatar
            fxLayoutAlign="center center"
            [class.orange-accent]="!AddingDevice"
            [class.green-accent]="AddingDevice"
          >
            <mat-icon>loop</mat-icon>
          </div>

          <mat-card-title> Connected Devices </mat-card-title>

          <div fxFlex></div>

          <mat-card-subtitle *ngIf="MaxDevicesReached && AddingDevice">
            Max number of devices reached
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content
          [class.margin-left-5]="
            AddingDevice || DevicesConfig?.Devices?.length <= 0
          "
        >
          <mat-progress-bar
            class="margin-top-2"
            mode="indeterminate"
            *ngIf="DevicesConfig?.Loading"
          ></mat-progress-bar>

          <div *ngIf="AddingDevice">
            <ng-container *ngIf="!MaxDevicesReached">
              <p class="paragraph-text">
                To connect a device and see its real-time data flowing through
                the system, simply enter a device name and enroll it. You will
                be provided with a connection string for your device.
              </p>
            </ng-container>

            <ng-container *ngIf="MaxDevicesReached">
              <p
                *ngIf="
                  DevicesConfig.MaxDevicesCount <
                  DevicesConfig.EnterpriseDevicesCount
                "
                class="paragraph-text"
              >
                Click "Upgrade Now" to see other plans where you can connect
                more than
                {{ DevicesConfig.MaxDevicesCount }}
                {{ DevicesConfig.MaxDevicesCount > 1 ? "devices" : "device" }},
                increase your data velocity, increase your data retention and
                other great benefits.
              </p>
              <p
                *ngIf="
                  DevicesConfig.MaxDevicesCount ===
                  DevicesConfig.EnterpriseDevicesCount
                "
                class="paragraph-text"
              >
                Please contact Fathym at
                <a href="mailto: sales@fathym.com" color="primary">
                  sales@fathym.com</a
                >
                for enterprise packages.
              </p>
            </ng-container>
          </div>

          <div class="device-list" *ngIf="!AddingDevice">
            <lcu-devices-table
              [devices-config]="DevicesConfig"
              (issued-sas-token)="IssueDeviceSASToken($event)"
              (page-event)="DeviceTablePageEvent($event)"
              (revoked)="RevokeDeviceEnrollmentClick($event)"
            ></lcu-devices-table>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <div fxFlex></div>

          <a
            mat-raised-button
            color="accent"
            (click)="ToggleAddingDevice()"
            *ngIf="!AddingDevice"
          >
            Enroll New Device
          </a>

          <ng-container *ngIf="AddingDevice && MaxDevicesReached">
            <a
              mat-button
              href="https://www.iot-ensemble.com/docs/getting-started/buy-and-scale"
              target="_blank"
              *ngIf="AddingDevice"
              color="accent"
            >
              Read Documentation
            </a>

            <a
              *ngIf="
                DevicesConfig.MaxDevicesCount <
                DevicesConfig.EnterpriseDevicesCount
              "
              mat-raised-button
              href="/billing/iot"
              color="accent"
              target="_blank"
            >
              Upgrade now
            </a>

            <a mat-button color="warn" (click)="ToggleAddingDevice()">
              <mat-icon>cancel</mat-icon>
              Cancel
            </a>
          </ng-container>
        </mat-card-actions>
      </mat-card>

      <form
        fxFlex="50%"
        fxFlex.lt-md="100%"
        [formGroup]="AddDeviceFormGroup"
        (ngSubmit)="EnrollDeviceSubmit()"
        *ngIf="AddingDevice && !MaxDevicesReached"
      >
        <mat-card>
          <mat-card-content>
            <div>
              <div class="device-adding">
                <h2>Enroll a New Device</h2>

                <mat-form-field>
                  <input
                    matInput
                    formControlName="deviceName"
                    placeholder="The Name of your Device"
                    required
                  />
                </mat-form-field>
              </div>

              <div *ngIf="DeviceNameErrorText">
                <mat-error>{{ DeviceNameErrorText }}</mat-error>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <div fxFlex></div>

            <ng-container>
              <button
                mat-raised-button
                type="submit"
                color="primary"
                *ngIf="!DevicesConfig?.Loading"
                [disabled]="!AddDeviceFormGroup.valid"
              >
                Enroll Device
              </button>

              <a mat-button color="warn" (click)="ToggleAddingDevice()">
                <mat-icon>cancel</mat-icon>
                Cancel
              </a>
            </ng-container>
          </mat-card-actions>
        </mat-card>
      </form>
    </div>
  </div>
  <!--^^^ Connected Devices ^^^-->

  <!-- Telemetry -->
  <div class="telemetry section">
    <mat-card fxLayout="column">
      <div
        fxFlex
        fxLayout="row"
        fxLayoutAlign="end start"
        class="margin-bottom-3"
      >
        <button
          mat-button
          color="primary"
          matTooltip="Download Telemetry Data"
          (click)="DownloadTelemetryModal()"
        >
          <mat-icon id="telemetry-download-element">download</mat-icon>
        </button>

        <lcu-enabled-toggle
          class="margin-right-3"
          [enabled]="Telemetry?.Enabled"
          enabled-text="Live"
          [loading]="Telemetry?.Loading"
          (enabled-toggled)="ToggleTelemetryEnabledChanged($event)"
        >
        </lcu-enabled-toggle>

        <a
          href="https://www.iot-ensemble.com/docs/getting-started/viewing-device-data#devices-telemetry"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </div>

      <div fxLayout="row" fxLayoutAlign="space-between center"></div>
      <mat-card-header class="border-bottom" fxLayout="row">
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>compare_arrows</mat-icon>
        </div>

        <mat-card-title>Devices Telemetry</mat-card-title>

        <mat-card-subtitle
          fxLayout="row"
          fxLayoutAlign="start"
          class="telemetry-update margin-top-2"
        >
          <!-- <lcu-loader [loading]="Telemetry?.Loading" [diameter]="20">
          </lcu-loader> -->

          <div matTooltip="Telemetry Sync Status">
            <mat-icon
              [class.success-dot]="Telemetry?.Enabled"
              [class.error-dot]="!Telemetry?.Enabled"
            >
              stop_circle
            </mat-icon>
          </div>

          Last Updated: {{ LastSyncedAt }}
        </mat-card-subtitle>
        <!-- <div
          fxFlex
          fxLayout="row"
          fxLayoutGap="20px"
          fxLayoutAlign="end center"
        > -->
        <!-- <lcu-refresh-select
                    [telemetry]="Telemetry"
                    (refresh-rate-changed)="RefreshRateChanged($event)"
                  >
                  </lcu-refresh-select> -->

        <!-- </div> -->
      </mat-card-header>

      <mat-card-content
        [class.margin-left-5]="Telemetry?.Payloads?.length <= 0"
      >
        <lcu-telemetry-list
          [telemetry]="Telemetry"
          (page-event)="HandleTelemetryPageEvent($event)"
        >
        </lcu-telemetry-list>
      </mat-card-content>

      <mat-card-actions>
        <div fxFlex></div>

        <button
          mat-raised-button
          color="primary"
          (click)="PayloadFormModal()"
          *ngIf="DevicesConfig?.Devices?.length >= 1"
        >
          Send Device Message
        </button>

        <!-- <button mat-raised-button (click)="DownloadData()">
                  Download Data
                </button> -->
      </mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Telemetry ^^^-->

  <!-- Dashboard -->
  <div class="dashboard section">
    <mat-card fxLayout="column">
      <div
        fxFlex
        fxLayout="row"
        fxLayoutAlign="end start"
        class="margin-bottom-3"
      >
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/emulated-data"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </div>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>dashboard</mat-icon>
        </div>

        <mat-card-title>Devices Dashboard</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <div class="margin-left-5 padding-bottom-2 margin-top-2">
          Here we have provided an example open-source dashboard Freeboard to
          show how your data can be visualized. Freeboard provides simple and
          easy to use dashboards for your devices.
        </div>
        <div class="freeboard-display padding-top-2">
          <iframe
            [src]="DashboardIFrameURL"
            width="100%"
            height="750px"
            frameborder="0"
          ></iframe>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <!--^^^ Dashboard ^^^-->

  <!-- Device Reports -->
  <!-- <div class="device-reports widget">
            <mat-card>
              <mat-card-header>
                <mat-card-title>Device Reports</mat-card-title>
              </mat-card-header>
            </mat-card>
          </div> -->

  <!-- Storage Access -->
  <div class="storage-access section">
    <mat-card fxLayout="column">
      <div
        fxFlex
        fxLayout="row"
        fxLayoutAlign="end start"
        class="margin-bottom-3"
      >
        <a
          href="https://www.iot-ensemble.com/docs/getting-started/emulated-data"
          target="_blank"
        >
          <mat-icon matTooltip="More info">help_outline</mat-icon>
        </a>
      </div>
      <mat-card-header>
        <div
          mat-card-avatar
          fxLayoutAlign="center center"
          class="orange-accent"
        >
          <mat-icon>storage</mat-icon>
        </div>

        <mat-card-title>Storage Access</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <div class="margin-left-5 margin-top-2">
          Use the API keys to get your data downstream to the dashboards and
          services of your choice for visualization, application development,
          ML/AI, and more.
        </div>
        <lcu-api-access
          [api-keys]="Storage?.APIKeys"
          [api-options]="Storage?.APIOptions"
          (regenerated)="RegenerateAPIKey($event)"
        ></lcu-api-access>
      </mat-card-content>

      <mat-card-actions></mat-card-actions>
    </mat-card>
  </div>
  <!--^^^ Storage Access ^^^-->
</div>
