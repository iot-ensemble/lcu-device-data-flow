<div *ngIf="!State.Loading">
  <div class="manage-header"></div>

  <div class="manage">
    <div
      class="devices spread"
      fxLayout="row wrap"
      fxLayoutAlign="center center"
    >
      <div fxFlex="30%" fxFlex.lt-md="100%">
        <div class="emulated widget">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Welcome To your Fathym Dashboard</mat-card-title>
            </mat-card-header>

            <mat-card-content>
              <p>
                Emulate, Simulate, and Connect your devices to discover the
                power of your IoT solution.
              </p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div fxFlex="70%" fxFlex.lt-md="100%">
        <div class="emulated widget">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Emulated Devices</mat-card-title>
            </mat-card-header>

            <mat-card-content>
              <p>
                When enabled, emulated device data will be provided in your data
                queries. The emulated device, is for smart room detection and
                provides temperature, humidity and occupancy of a room.
              </p>
            </mat-card-content>

            <mat-card-actions>
              <div fxFlex></div>

              <lcu-loader
                [loading]="EmulatedEnabledText == 'Saving...'"
              ></lcu-loader>

              <mat-slide-toggle
                #emulatedEnabled
                *ngIf="EmulatedEnabledText != 'Saving...'"
                [checked]="State.Emulated?.Enabled"
                (change)="ToggleEmulatedEnabledChanged($event)"
              >
                {{ EmulatedEnabledText }}
              </mat-slide-toggle>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>

      <div fxFlex="100%">
        <div class="connected widget">
          <form
            [formGroup]="AddDeviceFormGroup"
            (ngSubmit)="EnrollDeviceSubmit()"
          >
            <mat-card>
              <mat-card-header>
                <mat-card-title>Connected Devices</mat-card-title>
              </mat-card-header>

              <mat-card-content>
                <div class="device-list" *ngIf="!AddingDevice">
                  <div class="table-container">
                    <table mat-table [dataSource]="State.Devices">
                      <!-- matSort
                        matSortActive="created"
                        matSortDisableClear
                        matSortDirection="desc" -->

                      <tr
                        mat-header-row
                        *matHeaderRowDef="ConnectedDevicesDisplayedColumns"
                      ></tr>

                      <tr
                        mat-row
                        *matRowDef="
                          let device;
                          columns: ConnectedDevicesDisplayedColumns
                        "
                      ></tr>

                      <ng-container matColumnDef="deviceId">
                        <th mat-header-cell *matHeaderCellDef>Device ID</th>

                        <td mat-cell *matCellDef="let device">
                          <mat-form-field class="spread deviceId">
                            <input
                              matInput
                              [value]="device.DeviceID"
                              disabled
                            />
                          </mat-form-field>
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="deviceName">
                        <th mat-header-cell *matHeaderCellDef>Device Name</th>

                        <td mat-cell *matCellDef="let device">
                          {{ device.DeviceName }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="enabled">
                        <th mat-header-cell *matHeaderCellDef>Enabled</th>

                        <td mat-cell *matCellDef="let device">
                          <div class="spread enabled">device.Enabled</div>
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="lastUpdate">
                        <th mat-header-cell *matHeaderCellDef>Last Update</th>

                        <td mat-cell *matCellDef="let device">
                          <div class="spread last-update">
                            device.LastUpdate
                          </div>
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="connStr">
                        <th mat-header-cell *matHeaderCellDef>
                          Connection String
                        </th>

                        <td mat-cell *matCellDef="let device">
                          <mat-form-field class="spread connStr">
                            <input
                              matInput
                              [value]="device.ConnectionString"
                              disabled
                            />
                          </mat-form-field>
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef></th>

                        <td mat-cell *matCellDef="let device">
                          <a
                            mat-icon-button
                            color="warn"
                            (click)="RevokeDeviceEnrollmentClick(device)"
                          >
                            <mat-icon>delete</mat-icon>
                          </a>
                        </td>
                      </ng-container>

                      <!--
                    <ng-container matColumnDef="created">
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        disableClear
                      >
                        Created
                      </th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.created_at | date }}
                      </td>
                    </ng-container> -->
                    </table>
                  </div>

                  <mat-paginator
                    [length]="State.Devices.length"
                    [pageSize]="10"
                  ></mat-paginator>
                </div>

                <div class="device-adding" *ngIf="AddingDevice">
                  <h2>Add a New Device</h2>

                  <mat-form-field>
                    <input
                      matInput
                      formControlName="deviceName"
                      placeholder="The Name of your Device"
                      required
                    />
                  </mat-form-field>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <div fxFlex></div>

                <!-- <lcu-loader
                [loading]="EmulatedEnabledText == 'Saving...'"
              ></lcu-loader> -->

                <ng-container *ngIf="!AddingDevice">
                  <a mat-raised-button (click)="ToggleAddingDevice()">
                    Add New Device
                  </a>
                </ng-container>

                <ng-container *ngIf="AddingDevice">
                  <button mat-raised-button type="submit" color="primary">
                    Enroll Device
                  </button>

                  <a mat-button color="warn" (click)="ToggleAddingDevice()">
                    <mat-icon>cancel</mat-icon>
                    Cancel
                  </a>
                </ng-container>
              </mat-card-actions>
            </mat-card>
          </form>
        </div>
      </div>

      <div fxFlex="100%">
        <div class="dashboard widget">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Devices Dashboard</mat-card-title>
            </mat-card-header>

            <mat-card-content>
              <div class="freeboard-display">
                <!-- <div id="main-header">

                </div> -->

                <iframe
                  [src]="DashboardIFrameURL"
                  width="100%"
                  height="500px"
                  frameborder="0"
                ></iframe>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div fxFlex="100%">
        <div class="reports widget">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Device Reports</mat-card-title>
            </mat-card-header>
          </mat-card>
        </div>
      </div>

      <div fxFlex="100%">
        <div class="telemetry widget">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Device Telemetry</mat-card-title>
            </mat-card-header>

            <mat-card-content> </mat-card-content>

            <mat-card-actions>
              <div fxFlex></div>

              <lcu-loader
                [loading]="DeviceTelemetryEnabledText == 'Saving...'"
              ></lcu-loader>

              <mat-slide-toggle
                #devTelemEnabled
                *ngIf="DeviceTelemetryEnabledText != 'Saving...'"
                [checked]="State.DeviceTelemetry?.Enabled"
                (change)="ToggleDeviceTelemetryEnabledChanged($event)"
              >
                {{ DeviceTelemetryEnabledText }}
              </mat-slide-toggle>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>
    </div>

    <div class="storage-access">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Storage Access</mat-card-title>
        </mat-card-header>
      </mat-card>
    </div>
  </div>
</div>

<lcu-loader [loading]="State.Loading"></lcu-loader>
